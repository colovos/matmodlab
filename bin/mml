#!/bin/bash
# set up python environment
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ROOT="$(dirname "$DIR")"
export PYTHONPATH=$ROOT

usage()
{
cat << EOF
usage: mml [-h] <command> [<args>]

The mml commands are:
  build    Build fortran libraries
  clean    Clean simulation and build files generated by matmodlab
  config   Run the cofiguration tool
  run      Run a simulation
  test     Run tests
  view     Launch the matmodlab viewer

See 'mml help <command>' to read about a specific subcommand.

EOF
}

SUBCOMMANDS="build clean config run test view"
contains() {
  for word in $1; do
    [[ "$word" = "$2" ]] && return 0
  done
  return 1
}

getprog_no() {
    if contains "$SUBCOMMANDS" "$1";
    then
	PROG=$DIR/mml-$COMMAND
    else
	echo \'"$1"\': unknown subcommand
	usage
	exit 1
    fi
}

getprog() {
    local it="$DIR/mml-$1"
    if [ -f $it ]; then
	PROG="$it"
    else
	echo \'"$1"\': unknown subcommand
	usage
	exit 1
    fi
}

# option parsing - for now, only -h is supported
while getopts "h" OPTION
do
     case $OPTION in
         h)
             usage
             exit 1
             ;;
         ?)
             usage
             exit
             ;;
     esac
done

# positional parameters
COMMAND="$1"
shift
if [ $COMMAND == "help" ];
then
    COMMAND="$1"
    set -- "-h"
fi
getprog "$COMMAND"

$PROG "$@"
