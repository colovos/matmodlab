#!/usr/bin/env bash
# set up python environment
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ROOT="$(dirname "$DIR")"
export PYTHONPATH="$ROOT"

usage()
{
cat << EOF
usage: mml [-h] <command> [<args>]

The mml commands are:
  build    Build fortran libraries
  clean    Clean simulation and build files generated by matmodlab
  config   Run the cofiguration tool
  run      Run a simulation
  test     Run tests
  view     Launch the matmodlab viewer

See 'mml help <command>' to read about a specific subcommand.

EOF
}

getprog() {
    local it="$DIR/mml-$1"
    if [ -f $it ]; then
	PROG="$it"
    else
	if test -z "$1"; then
            echo "*** error: mml:" required command not found
	else
	    echo "*** error: mml:" receieved unrecognized command \'"$1"\'
	fi
	usage
	exit 1
    fi
}

# option parsing - for now, only -h is supported
while getopts "h" OPTION
do
     case $OPTION in
         h)
             usage
             exit 1
             ;;
         ?)
             usage
             exit
             ;;
     esac
done

# positional parameters
COMMAND="$1"
shift
if [ "$COMMAND" == "help" ];
then
    COMMAND="$1"
    set -- "-h"
fi
getprog "$COMMAND"

$PROG "$@"
